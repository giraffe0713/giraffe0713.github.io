<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>img_canvas</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
</head>
<body>
	<p>Rotate by dragging blue rotation handle</p>
    <canvas id="mycanvas" width="300" height="300"></canvas>
<script src="js/jquery-1.10.2.js"></script>
<script>
	var mycanvas = document.getElementById("mycanvas");
	var ctx = mycanvas.getContext("2d");

	var canvasOffset = $("#mycanvas").offset();
	var offsetX = canvasOffset.left;
	var offsetY = canvasOffset.top;

	var startX,startY;
	var isDown = false;

	var cx = mycanvas.width/2;
	var cy = mycanvas.height/2;

	var w,h,r=0;
	var img = new Image();
	img.onload = function(){
		w = img.width/2;
		h = img.height/2;
		draw();
	}
	img.src = "images/whitehorse.jpg";


	function draw(){
		ctx.clearRect(0,0,mycanvas.width,mycanvas.height);
		drawRotationHandle(true);
		drawRect();
	}

	function drawRect(){
		ctx.save();
		ctx.translate(cx,cy);
		ctx.rotate(r);
		ctx.drawImage(img,0,0,img.width,img.height,-w/2,-h/2,w,h);
		ctx.restore();
	}


	function drawRotationHandle(withFill){
		ctx.save();
		ctx.translate(cx,cy);
		ctx.rotate(r);
		ctx.beginPath();
		ctx.moveTo(0,-1);
		ctx.lineTo(w/2+20,-1);
		ctx.lineTo(w/2+20,-7);
		ctx.lineTo(w/2+30,-7);
		ctx.lineTo(w/2+30,7);
		ctx.lineTo(w/2+20,7);
		ctx.lineTo(w/2+20,1);
		ctx.lineTo(0,1);
		ctx.closePath();
		if(withFill){
			ctx.fillStyle = "blue";
			ctx.fill();
		}
		ctx.restore();
	}


	function handleMouseDown(e) {
		mouseX = parseInt(e.clientX - offsetX);
		mouseY = parseInt(e.clientY - offsetY);
		drawRotationHandle(false);
		isDown = ctx.isPointInPath(mouseX,mouseY);
		console.log(isDown);
	}

	function handleMouseUp(e) {
		isDown = false;
	}

	function handleMouseOut(e) {
		isDown = false;
	}

	function handleMouseMove(e) {
		if(!isDown){
			return;
		}
	}



</script>
</body>
</html>